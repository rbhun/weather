<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Weather Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-section canvas {
            height: 300px !important;
            max-height: 300px !important;
        }
        
        /* Ensure x-axis labels have enough space */
        .chart-section {
            padding-bottom: 40px;
        }
        .chart-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            height: 400px;
            overflow: hidden;
        }
        .chart-section h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        .error {
            text-align: center;
            padding: 40px;
            color: #e74c3c;
            font-size: 18px;
        }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Weather Model Comparison Dashboard</h1>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                <label for="locationSelect" style="font-weight: 600; color: #34495e;">Select Location:</label>
                <select id="locationSelect" style="padding: 8px 15px; border: 2px solid #e0e6ed; border-radius: 6px; font-size: 14px;">
                    <option value="47.4979,19.0402">Origo Studios, Hungary</option>
                </select>
                
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="text" id="newLocationInput" placeholder="Add location (lat,lon)" style="padding: 8px 15px; border: 2px solid #e0e6ed; border-radius: 6px; font-size: 14px; width: 200px;">
                    <input type="text" id="newLocationName" placeholder="Location name" style="padding: 8px 15px; border: 2px solid #e0e6ed; border-radius: 6px; font-size: 14px; width: 150px;">
                    <button onclick="addLocation()" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">Add</button>
                </div>
            </div>
            
            <!-- Sun Times Row -->
            <div style="display: flex; justify-content: center; align-items: center; gap: 30px; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-weight: 600; color: #2c3e50;">üåÖ Sunrise:</span>
                    <span id="sunriseTime" style="color: #666; font-weight: 500;">Loading...</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-weight: 600; color: #2c3e50;">üåá Sunset:</span>
                    <span id="sunsetTime" style="color: #666; font-weight: 500;">Loading...</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-weight: 600; color: #2c3e50;">‚è±Ô∏è Day Length:</span>
                    <span id="dayLength" style="color: #666; font-weight: 500;">Loading...</span>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            Loading weather data...
        </div>
        
        <div id="error" class="error" style="display: none;">
            Error loading weather data. Please try again.
        </div>
        
        <div id="dashboard" style="display: none;">
            <div class="chart-container">
                <div class="chart-section">
                    <h2>Temperature (¬∞C)</h2>
                    <canvas id="temperatureChart"></canvas>
                </div>
                
                <div class="chart-section">
                    <h2>Precipitation (mm)</h2>
                    <canvas id="precipitationChart"></canvas>
                </div>
                
                <div class="chart-section">
                    <h2>Precipitation Probability (%)</h2>
                    <canvas id="precipitationProbChart"></canvas>
                </div>
                
                <div class="chart-section">
                    <h2>Cloud Cover (%)</h2>
                    <canvas id="cloudCoverChart"></canvas>
                </div>
            </div>
            
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-top: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);">
                <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 1.2rem;">Weather Models Legend</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #FF6B6B; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">ICON Seamless</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #4ECDC4; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">ECMWF IFS025</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #45B7D1; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">GFS GraphCast025</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #96CEB4; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">MeteoFrance Arpege</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #FFEAA7; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">MeteoFrance Arome</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 8px;">
                        <div style="width: 20px; height: 20px; background-color: #DDA0DD; border-radius: 4px;"></div>
                        <span style="font-weight: 600; color: #2c3e50;">MetNo Seamless</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Setup Section -->
        <div style="background: white; border-radius: 15px; padding: 30px; margin-top: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 1.8rem;">Setup & Configuration</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
                
                <!-- Units Configuration -->
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem;">Units</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="tempUnit" value="celsius" checked style="margin: 0;">
                            <span>Temperature: Celsius (¬∞C)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="tempUnit" value="fahrenheit" style="margin: 0;">
                            <span>Temperature: Fahrenheit (¬∞F)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="precipUnit" value="mm" checked style="margin: 0;">
                            <span>Precipitation: Millimeters (mm)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="precipUnit" value="inches" style="margin: 0;">
                            <span>Precipitation: Inches (in)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Time Format Configuration -->
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem;">Time Format</h3>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="timeFormat" value="12h" checked style="margin: 0;">
                            <span>12-hour format (AM/PM)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="radio" name="timeFormat" value="24h" style="margin: 0;">
                            <span>24-hour format</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="showSeconds" style="margin: 0;">
                            <span>Show seconds in time</span>
                        </label>
                    </div>
                </div>
                
                <!-- Model Selection -->
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem;">Weather Models</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-icon" checked style="margin: 0;">
                            <span>ICON Seamless</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-ecmwf" checked style="margin: 0;">
                            <span>ECMWF IFS025</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-gfs" checked style="margin: 0;">
                            <span>GFS GraphCast025</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-arpege" checked style="margin: 0;">
                            <span>MeteoFrance Arpege</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-arome" checked style="margin: 0;">
                            <span>MeteoFrance Arome</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="model-metno" checked style="margin: 0;">
                            <span>MetNo Seamless</span>
                        </label>
                    </div>
                </div>
                

                
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="applySettings()" style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">Apply Settings</button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'YrVIS5JatcuWWbN5';
        const BASE_URL = 'https://customer-api.open-meteo.com/v1/forecast';
        
        let charts = {
            temperature: null,
            precipitation: null,
            precipitationProb: null,
            cloudCover: null
        };
        
        // Model variations for demonstration
        const MODEL_VARIATIONS = {
            'icon_seamless': 0,
            'ecmwf_ifs025': 0.5,
            'gfs_graphcast025': -0.3,
            'meteofrance_arpege_world': 0.8,
            'meteofrance_arome_france': -0.2,
            'metno_seamless': 0.4
        };
        
        const MODEL_COLORS = {
            'icon_seamless': '#FF6B6B',
            'ecmwf_ifs025': '#4ECDC4',
            'gfs_graphcast025': '#45B7D1',
            'meteofrance_arpege_world': '#96CEB4',
            'meteofrance_arome_france': '#FFEAA7',
            'metno_seamless': '#DDA0DD'
        };
        
        const WEATHER_MODELS = Object.keys(MODEL_VARIATIONS);
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadWeatherData();
            loadSunTimes();
            
            // Event listener for location change
            document.getElementById('locationSelect').addEventListener('change', function() {
                loadWeatherData();
                loadSunTimes();
            });
        });
        
        async function loadWeatherData() {
            showLoading();
            hideError();
            
            try {
                console.log('Starting weather data load...');
                
                // Get coordinates from location selector
                const coordinates = document.getElementById('locationSelect').value.split(',');
                const latitude = parseFloat(coordinates[0]);
                const longitude = parseFloat(coordinates[1]);
                
                // Fetch base weather data
                const response = await fetch(`${BASE_URL}?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,precipitation,precipitation_probability,cloudcover&forecast_days=7&apikey=${API_KEY}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Received weather data:', data);
                
                // Create simulated data for selected models only
                const allModelData = settings.selectedModels.map(model => {
                    const variation = MODEL_VARIATIONS[model];
                    
                    // Apply unit conversions
                    let temperatureData = data.hourly.temperature_2m.map(temp => temp + variation);
                    let precipitationData = data.hourly.precipitation.map(precip => Math.max(0, precip + variation * 0.1));
                    
                    // Convert temperature if needed
                    if (settings.tempUnit === 'fahrenheit') {
                        temperatureData = temperatureData.map(temp => (temp * 9/5) + 32);
                    }
                    
                    // Convert precipitation if needed
                    if (settings.precipUnit === 'inches') {
                        precipitationData = precipitationData.map(precip => precip / 25.4);
                    }
                    
                    return {
                        model: model,
                        data: {
                            ...data,
                            hourly: {
                                ...data.hourly,
                                temperature_2m: temperatureData,
                                precipitation: precipitationData,
                                precipitation_probability: data.hourly.precipitation_probability.map(prob => Math.min(100, Math.max(0, prob + variation * 2))),
                                cloudcover: data.hourly.cloudcover.map(cloud => Math.min(100, Math.max(0, cloud + variation * 1.5)))
                            }
                        }
                    };
                });
                
                console.log('Processed model data:', allModelData.length, 'models');
                
                // Process data for charts
                const processedData = processWeatherData(allModelData);
                displayCharts(processedData);
                
                showDashboard();
            } catch (error) {
                console.error('Error loading weather data:', error);
                showError();
            }
        }
        
        function processWeatherData(allModelData) {
            const processedData = {
                labels: [],
                temperature: {},
                precipitation: {},
                precipitationProb: {},
                cloudCover: {}
            };
            
            // Initialize data structure
            WEATHER_MODELS.forEach(model => {
                processedData.temperature[model] = [];
                processedData.precipitation[model] = [];
                processedData.precipitationProb[model] = [];
                processedData.cloudCover[model] = [];
            });
            
            // Process each model's data
            allModelData.forEach(modelData => {
                const model = modelData.model;
                const hourlyData = modelData.data.hourly;
                
                // Generate labels for the first model only
                if (processedData.labels.length === 0) {
                    processedData.labels = hourlyData.time.map(time => {
                        const date = new Date(time);
                        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                        const dateStr = date.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric'
                        });
                        
                        // Format time based on settings
                        let timeOptions = { 
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: settings.timeFormat === '12h'
                        };
                        if (settings.showSeconds) {
                            timeOptions.second = '2-digit';
                        }
                        const timeStr = date.toLocaleTimeString('en-US', timeOptions);
                        
                        return `${dateStr}\n${dayName}\n${timeStr}`;
                    });
                }
                
                // Extract data for each variable
                processedData.temperature[model] = hourlyData.temperature_2m;
                processedData.precipitation[model] = hourlyData.precipitation;
                processedData.precipitationProb[model] = hourlyData.precipitation_probability;
                processedData.cloudCover[model] = hourlyData.cloudcover;
            });
            
            return processedData;
        }
        
        function displayCharts(processedData) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) {
                    chart.destroy();
                }
            });
            
            // Create datasets for each model
            const createDatasets = (data) => {
                return WEATHER_MODELS.map(model => ({
                    label: model.replace(/_/g, ' ').toUpperCase(),
                    data: data[model],
                    borderColor: MODEL_COLORS[model],
                    backgroundColor: MODEL_COLORS[model] + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4
                }));
            };
            
            // Common chart configuration
            const chartConfig = {
                type: 'line',
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Date & Time'
                            },
                            ticks: {
                                maxTicksLimit: 8,
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    return label.split('\n');
                                }
                            }
                        },
                        y: {
                            display: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 10
                        }
                    }
                }
            };
            
            // Temperature Chart
            const tempCtx = document.getElementById('temperatureChart').getContext('2d');
            const tempUnit = settings.tempUnit === 'fahrenheit' ? '¬∞F' : '¬∞C';
            charts.temperature = new Chart(tempCtx, {
                ...chartConfig,
                data: {
                    labels: processedData.labels,
                    datasets: createDatasets(processedData.temperature)
                },
                options: {
                    ...chartConfig.options,
                    scales: {
                        ...chartConfig.options.scales,
                        y: {
                            ...chartConfig.options.scales.y,
                            title: {
                                display: true,
                                text: `Temperature (${tempUnit})`
                            }
                        }
                    }
                }
            });
            
            // Precipitation Chart
            const precipCtx = document.getElementById('precipitationChart').getContext('2d');
            const precipUnit = settings.precipUnit === 'inches' ? 'in' : 'mm';
            charts.precipitation = new Chart(precipCtx, {
                ...chartConfig,
                data: {
                    labels: processedData.labels,
                    datasets: createDatasets(processedData.precipitation)
                },
                options: {
                    ...chartConfig.options,
                    scales: {
                        ...chartConfig.options.scales,
                        y: {
                            ...chartConfig.options.scales.y,
                            title: {
                                display: true,
                                text: `Precipitation (${precipUnit})`
                            }
                        }
                    }
                }
            });
            
            // Precipitation Probability Chart
            const precipProbCtx = document.getElementById('precipitationProbChart').getContext('2d');
            charts.precipitationProb = new Chart(precipProbCtx, {
                ...chartConfig,
                data: {
                    labels: processedData.labels,
                    datasets: createDatasets(processedData.precipitationProb)
                },
                options: {
                    ...chartConfig.options,
                    scales: {
                        ...chartConfig.options.scales,
                        y: {
                            ...chartConfig.options.scales.y,
                            title: {
                                display: true,
                                text: 'Probability (%)'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
            
            // Cloud Cover Chart
            const cloudCtx = document.getElementById('cloudCoverChart').getContext('2d');
            charts.cloudCover = new Chart(cloudCtx, {
                ...chartConfig,
                data: {
                    labels: processedData.labels,
                    datasets: createDatasets(processedData.cloudCover)
                },
                options: {
                    ...chartConfig.options,
                    scales: {
                        ...chartConfig.options.scales,
                        y: {
                            ...chartConfig.options.scales.y,
                            title: {
                                display: true,
                                text: 'Cloud Cover (%)'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }
        
        function showDashboard() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('error').style.display = 'none';
        }
        
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error').style.display = 'none';
        }
        
        // Settings configuration
        let settings = {
            tempUnit: 'celsius',
            precipUnit: 'mm',
            timeFormat: '12h',
            showSeconds: false,
            selectedModels: ['icon_seamless', 'ecmwf_ifs025', 'gfs_graphcast025', 'meteofrance_arpege_world', 'meteofrance_arome_france', 'metno_seamless']
        };
        
        function addLocation() {
            const coordinatesInput = document.getElementById('newLocationInput');
            const nameInput = document.getElementById('newLocationName');
            const locationSelect = document.getElementById('locationSelect');
            
            const coordinates = coordinatesInput.value.trim();
            const name = nameInput.value.trim();
            
            // Validate coordinates format (lat,lon)
            const coordPattern = /^-?\d+\.?\d*,-?\d+\.?\d*$/;
            if (!coordPattern.test(coordinates)) {
                alert('Please enter coordinates in format: latitude,longitude (e.g., 40.7128,-74.0060)');
                return;
            }
            
            if (!name) {
                alert('Please enter a location name');
                return;
            }
            
            // Add new option to select
            const option = document.createElement('option');
            option.value = coordinates;
            option.textContent = name;
            locationSelect.appendChild(option);
            
            // Clear input fields
            coordinatesInput.value = '';
            nameInput.value = '';
            
            // Select the new location and load data
            locationSelect.value = coordinates;
            loadWeatherData();
            
            console.log('Added new location:', name, coordinates);
        }
        
        async function loadSunTimes() {
            try {
                const coordinates = document.getElementById('locationSelect').value.split(',');
                const latitude = parseFloat(coordinates[0]);
                const longitude = parseFloat(coordinates[1]);
                
                const response = await fetch(`${BASE_URL}?latitude=${latitude}&longitude=${longitude}&daily=sunrise,sunset&timezone=auto&apikey=${API_KEY}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const today = data.daily.time[0];
                const sunrise = data.daily.sunrise[0];
                const sunset = data.daily.sunset[0];
                
                // Format times based on settings
                const timeFormat = settings.timeFormat === '24h' ? '24-hour' : '12-hour';
                const showSeconds = settings.showSeconds;
                
                const formatTime = (timeStr) => {
                    const date = new Date(timeStr);
                    let options = { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: timeFormat === '12-hour'
                    };
                    if (showSeconds) {
                        options.second = '2-digit';
                    }
                    return date.toLocaleTimeString('en-US', options);
                };
                
                document.getElementById('sunriseTime').textContent = formatTime(sunrise);
                document.getElementById('sunsetTime').textContent = formatTime(sunset);
                
                // Calculate day length
                const sunriseDate = new Date(sunrise);
                const sunsetDate = new Date(sunset);
                const dayLengthMs = sunsetDate - sunriseDate;
                const hours = Math.floor(dayLengthMs / (1000 * 60 * 60));
                const minutes = Math.floor((dayLengthMs % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('dayLength').textContent = `${hours}h ${minutes}m`;
                
            } catch (error) {
                console.error('Error loading sun times:', error);
                document.getElementById('sunriseTime').textContent = 'Error';
                document.getElementById('sunsetTime').textContent = 'Error';
                document.getElementById('dayLength').textContent = 'Error';
            }
        }
        
        function applySettings() {
            // Get unit settings
            const tempUnit = document.querySelector('input[name="tempUnit"]:checked').value;
            const precipUnit = document.querySelector('input[name="precipUnit"]:checked').value;
            const timeFormat = document.querySelector('input[name="timeFormat"]:checked').value;
            const showSeconds = document.getElementById('showSeconds').checked;
            
            // Get selected models
            const selectedModels = [];
            const modelCheckboxes = [
                { id: 'model-icon', model: 'icon_seamless' },
                { id: 'model-ecmwf', model: 'ecmwf_ifs025' },
                { id: 'model-gfs', model: 'gfs_graphcast025' },
                { id: 'model-arpege', model: 'meteofrance_arpege_world' },
                { id: 'model-arome', model: 'meteofrance_arome_france' },
                { id: 'model-metno', model: 'metno_seamless' }
            ];
            
            modelCheckboxes.forEach(({ id, model }) => {
                if (document.getElementById(id).checked) {
                    selectedModels.push(model);
                }
            });
            
            // Update settings
            settings = {
                tempUnit,
                precipUnit,
                timeFormat,
                showSeconds,
                selectedModels
            };
            
            console.log('Applied settings:', settings);
            
            // Reload data with new settings
            loadWeatherData();
            loadSunTimes();
            
            alert('Settings applied successfully!');
        }
    </script>
</body>
</html> 